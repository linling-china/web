<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>账户信息管理系统</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
</head>
<body>
    <div class="container mt-4">
        <div class="row">
            <div class="col-12">
                <h1 class="text-center mb-4">账户信息管理系统</h1>
                
                {% with messages = get_flashed_messages() %}
                    {% if messages %}
                        <div class="alert alert-info">
                            {% for message in messages %}
                                <div class="alert alert-success">{{ message }}</div>
                            {% endfor %}
                        </div>
                    {% endif %}
                {% endwith %}
                
                <div class="d-flex justify-content-center mb-4 gap-2">
                    <a href="{{ url_for('add_account') }}" class="btn btn-primary">
                        <i class="bi bi-plus-circle"></i> 添加新账户
                    </a>
                    <a href="{{ url_for('import_excel') }}" class="btn btn-secondary">
                        <i class="bi bi-file-earmark-excel"></i> 导入Excel
                    </a>
                    <a href="{{ url_for('export') }}" class="btn btn-success">
                        <i class="bi bi-file-earmark-arrow-down"></i> 导出Excel
                    </a>
                </div>
                
                <div class="row mb-4">
                    <div class="col-md-6 offset-md-3">
                        <div class="input-group">
                            <input type="text" id="searchInput" class="form-control" placeholder="搜索用户姓名、账号、部门等...">
                            <button class="btn btn-outline-secondary" onclick="searchTable()">搜索</button>
                        </div>
                    </div>
                </div>
                
                <div class="table-responsive">
                    <table class="table table-striped table-hover" id="accountsTable">
                        <thead class="table-dark">
                            <tr>
                                <th>用户姓名</th>
                                <th>账号</th>
                                <th>资产编号</th>
                                <th>计算机名</th>
                                <th>联系电话</th>
                                <th>所在部门</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for account in accounts %}
                            <tr>
                                <td>{{ account['user_name'] or '' }}</td>
                                <td>{{ account['account_number'] or '' }}</td>
                                <td>{{ account['asset_number'] or '' }}</td>
                                <td>{{ account['computer_name'] or '' }}</td>
                                <td>{{ account['phone_number'] or '' }}</td>
                                <td>{{ account['department'] or '' }}</td>
                                <td>
                                    <a href="{{ url_for('edit_account', id=account['id']) }}" class="btn btn-sm btn-outline-primary me-1">
                                        <i class="bi bi-pencil"></i> 编辑
                                    </a>
                                    <form action="{{ url_for('delete_account', id=account['id']) }}" method="post" style="display: inline;">
                                        <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('确定要删除这个账户吗？')">
                                            <i class="bi bi-trash"></i> 删除
                                        </button>
                                    </form>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                
                {% if not accounts %}
                <div class="text-center mt-5">
                    <p class="text-muted">暂无账户信息，请添加新账户或导入Excel文件。</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        function searchTable() {
            const input = document.getElementById("searchInput");
            const filter = input.value.toUpperCase();
            const table = document.getElementById("accountsTable");
            const tr = table.getElementsByTagName("tr");
            
            for (let i = 1; i < tr.length; i++) {
                const td = tr[i].getElementsByTagName("td");
                let found = false;
                
                for (let j = 0; j < td.length - 1; j++) { // Exclude the last column (actions)
                    if (td[j]) {
                        const txtValue = td[j].textContent || td[j].innerText;
                        if (txtValue.toUpperCase().indexOf(filter) > -1) {
                            found = true;
                            break;
                        }
                    }
                }
                
                tr[i].style.display = found ? "" : "none";
            }
        }
        
        // Add search on input
        document.getElementById("searchInput").addEventListener("keyup", function(event) {
            if (event.key === "Enter") {
                searchTable();
            }
        });
    </script>
</body>
</html>